/* Accessibility Styles */

/* ===================================
   Focus Indicators
   =================================== */

/* Global focus styles for keyboard navigation */
*:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* Remove default focus outline for mouse users */
*:focus:not(:focus-visible) {
  outline: none;
}

/* Enhanced focus for interactive elements */
button:focus-visible,
a:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
[role="button"]:focus-visible,
[tabindex]:not([tabindex="-1"]):focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.25);
}

/* Dark theme focus adjustments */
[data-bs-theme="dark"] button:focus-visible,
[data-bs-theme="dark"] a:focus-visible,
[data-bs-theme="dark"] input:focus-visible,
[data-bs-theme="dark"] select:focus-visible,
[data-bs-theme="dark"] textarea:focus-visible,
[data-bs-theme="dark"] [role="button"]:focus-visible,
[data-bs-theme="dark"] [tabindex]:not([tabindex="-1"]):focus-visible {
  outline-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.4);
}

/* Focus for navigation links */
.nav-link:focus-visible {
  outline: 2px solid rgba(255, 255, 255, 0.8);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2);
}

/* Focus for cards */
.card:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
  box-shadow: var(--shadow-lg), 0 0 0 4px rgba(13, 110, 253, 0.25);
}

/* Focus for form controls */
.form-control:focus,
.form-select:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  outline: none;
}

/* Focus for buttons */
.btn:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.25);
}

.btn-primary:focus-visible {
  box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.4);
}

.btn-secondary:focus-visible {
  box-shadow: 0 0 0 4px rgba(108, 117, 125, 0.4);
}

.btn-success:focus-visible {
  box-shadow: 0 0 0 4px rgba(25, 135, 84, 0.4);
}

.btn-danger:focus-visible {
  box-shadow: 0 0 0 4px rgba(220, 53, 69, 0.4);
}

/* Focus for close buttons */
.btn-close:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.25);
}

/* Focus for toast close button */
.toast-close:focus-visible {
  outline: 2px solid currentColor;
  outline-offset: 2px;
  opacity: 1;
}

/* Focus for breadcrumb links */
.breadcrumb-item a:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* ===================================
   Keyboard Navigation Helpers
   =================================== */

/* Skip to main content link */
.skip-to-main {
  position: absolute;
  top: -100px;
  left: 0;
  background-color: var(--primary);
  color: white;
  padding: var(--spacing-md) var(--spacing-lg);
  text-decoration: none;
  font-weight: var(--font-weight-medium);
  z-index: 9999;
  border-radius: 0 0 var(--radius-md) 0;
  transition: top var(--transition-base) var(--ease-out);
}

.skip-to-main:focus {
  top: 0;
  outline: 2px solid white;
  outline-offset: -4px;
}

/* Ensure logical tab order */
[tabindex="-1"]:focus {
  outline: none;
}

/* ===================================
   Touch Target Sizes (Mobile)
   =================================== */

/* Minimum 44x44px touch targets for mobile */
@media (max-width: 767px) {
  button,
  a,
  input[type="checkbox"],
  input[type="radio"],
  select,
  [role="button"] {
    min-height: 44px;
    min-width: 44px;
  }

  /* Adjust padding for smaller buttons to maintain touch target */
  .btn-sm {
    min-height: 44px;
    padding: 0.5rem 1rem;
  }

  /* Icon-only buttons */
  .btn.icon-only,
  .theme-toggle,
  .toast-close {
    min-height: 44px;
    min-width: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
}

/* ===================================
   Screen Reader Only Content
   =================================== */

/* Visually hidden but accessible to screen readers */
.sr-only,
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Allow focus on sr-only elements */
.sr-only-focusable:focus,
.visually-hidden-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  padding: inherit;
  margin: inherit;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* ===================================
   High Contrast Mode Support
   =================================== */

/* Ensure borders are visible in high contrast mode */
@media (prefers-contrast: high) {
  button,
  a,
  input,
  select,
  textarea {
    border: 2px solid currentColor;
  }

  .btn {
    border-width: 2px;
  }

  *:focus-visible {
    outline-width: 3px;
    outline-offset: 3px;
  }
}

/* ===================================
   Reduced Motion Support
   =================================== */

/* Already handled in animations.css, but ensure focus transitions respect it */
@media (prefers-reduced-motion: reduce) {
  *:focus-visible {
    transition: none;
  }
}

/* ===================================
   ARIA Live Regions
   =================================== */

/* Ensure live regions are positioned correctly */
[role="status"],
[role="alert"],
[aria-live] {
  position: relative;
}

/* Toast container as live region - positioned in ToastContainer.css */

/* ===================================
   Disabled State Accessibility
   =================================== */

/* Ensure disabled elements are clearly indicated */
button:disabled,
input:disabled,
select:disabled,
textarea:disabled,
[aria-disabled="true"] {
  cursor: not-allowed;
  opacity: 0.6;
}

/* Prevent focus on disabled elements */
button:disabled:focus,
input:disabled:focus,
select:disabled:focus,
textarea:disabled:focus {
  outline: none;
  box-shadow: none;
}

/* ===================================
   Tooltip Accessibility
   =================================== */

/* Ensure tooltip triggers are keyboard accessible */
.tooltip-wrapper {
  display: inline-block;
}

/* Tooltip visibility on focus is handled in Tooltip.tsx component */

/* ===================================
   Modal and Dialog Accessibility
   =================================== */

/* Modal focus management is handled by Bootstrap */
.modal:focus {
  outline: none;
}

.modal-content:focus {
  outline: none;
}

/* ===================================
   Form Validation Accessibility
   =================================== */

/* Ensure validation messages are associated with inputs */
.invalid-feedback,
.valid-feedback {
  display: block;
  margin-top: var(--spacing-xs);
  font-size: var(--font-size-sm);
}

/* Ensure error states are not conveyed by color alone */
.is-invalid {
  border-color: var(--danger);
  border-width: 2px;
  border-style: solid;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right calc(0.375em + 0.1875rem) center;
  background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
  padding-right: calc(1.5em + 0.75rem);
}

.is-valid {
  border-color: var(--success);
  border-width: 2px;
  border-style: solid;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right calc(0.375em + 0.1875rem) center;
  background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
  padding-right: calc(1.5em + 0.75rem);
}

/* Additional visual patterns for color-blind users */
/* Success, danger, and warning states use both color and icons to convey meaning */
.table-success,
.card-success,
.table-danger,
.card-danger,
.table-warning,
.card-warning {
  position: relative;
}

/* Profit indicators use both color and icons - implemented in Calculator component */

/* Link underlines for better identification */
a:not(.btn):not(.nav-link):not(.navbar-brand):not(.breadcrumb-item a) {
  text-decoration: underline;
  text-decoration-thickness: 1px;
  text-underline-offset: 2px;
}

a:not(.btn):not(.nav-link):not(.navbar-brand):not(.breadcrumb-item a):hover {
  text-decoration-thickness: 2px;
}

/* ===================================
   Color Contrast Utilities
   =================================== */

/* Ensure sufficient contrast for all text */
.text-muted {
  color: var(--text-secondary) !important;
}

/* Ensure links have sufficient contrast */
a {
  text-decoration: underline;
  text-decoration-thickness: 1px;
  text-underline-offset: 2px;
}

a:hover {
  text-decoration-thickness: 2px;
}

/* Remove underline from navigation links */
.nav-link,
.navbar-brand,
.breadcrumb-item a {
  text-decoration: none;
}

/* ===================================
   Keyboard-Only Interactions
   =================================== */

/* Show additional context on keyboard focus */
.has-tooltip:focus-visible::after {
  content: attr(aria-label);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background-color: var(--dark);
  color: var(--light);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-xs);
  white-space: nowrap;
  z-index: 1000;
  margin-bottom: var(--spacing-xs);
}

[data-bs-theme="dark"] .has-tooltip:focus-visible::after {
  background-color: var(--light);
  color: var(--dark);
}
